---
# tasks file for infrastructure

- name: Install docker compose python package
  pip:
    name:
    - docker
    - docker-compose

- name: Git checkout
  git:
    repo: "{{ git_repository }}"
    dest: "{{ deployment_path }}"
    version: "{{ git_branch }}"

- name: Run docker compose
  docker_compose:
    project_src: "{{ deployment_path }}"
    build: true
    debug: true

- name: Run a chmod command
  community.docker.docker_container_exec:
    container: jenkins_agent_1
    command: /bin/bash -c "chmod 666 /var/run/docker.sock"
    chdir: /root
  register: result
